name: Deploy Phase
on:
  workflow_call:
    inputs:
      component:
        type: string
        required: true
      environment:
        type: string
        required: true
      runner:
        type: string
        required: true
    outputs:
      compstatus1:
        description: "First output from the component"
        value: ${{ jobs.Phase1.outputs.comp1status }}
      compstatus2:
        description: "Second output from the component"
        value: ${{ jobs.Phase1.outputs.comp2status }}
      phasestatus1:
        description: "First output from the component"
        value: ${{ jobs.phase-status.outputs.phase1op }}
      phasestatus2:
        description: "First output from the component"
        value: ${{ jobs.phase-status.outputs.phase2op }}
jobs:
  Phase1:
    if: ${{ ! contains(inputs.component, 'fullstack') }}
    uses: ./.github/workflows/deploy-component.yml
    with: 
      component: ${{ inputs.component }}
      environment: ${{ inputs.environment }}
      runner: ${{ inputs.runner }}

  
  Phase2:
    if: ${{  inputs.component == 'fullstack' }}
    uses: ./.github/workflows/deploy-component.yml
    with: 
      component: ${{ inputs.component }}
      environment: ${{ inputs.environment }}
      runner: ${{ inputs.runner }}
      
  phase-status:
    needs: Phase1
    runs-on: ubuntu-latest
    outputs: 
      phase1op: ${{ needs.report.outputs.Phase1status }}
      phase2op: ${{ needs.report.outputs.Phase2status }}
      #comp1op: ${{ needs.report.outputs.comp1status }}
      #comp2op: ${{ needs.report.outputs.comp1status }}
    steps:
      - name: Report job statuses
        id: report
        run: |
          echo "Phase1status: ${{ needs.Phase1.result }}"
          echo "Phase2status: ${{ needs.Phase2.result }}"
          echo "comp1status: ${{ needs.Phase1.outputs.compstatus1 }}"
          echo "comp2status: ${{ needs.Phase2.outputs.compstatus2 }}"
         
